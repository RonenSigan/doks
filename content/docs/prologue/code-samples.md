---
title: "Code Samples"
slug: "code-samples"
hidden: false
createdAt: "2020-07-07T07:58:42.159Z"
updatedAt: "2020-09-13T13:05:08.451Z"
---
The API Reference and the Use Cases contain code samples for your convenience. There are JSON samples for requests and responses for all requests in the system. In addition, in the Payments platform, there are samples of requests in various programming languages.

* **JSON** - You can run any of the JSON examples using any tool you like. You must follow the requirements for headers and signatures, as specified in [Request Signatures](ref:request-signatures) and the documentation for each method.
* **Programming languages** - You can run the example requests using your own workbench.
[block:callout]
{
  "type": "warning",
  "title": "Note",
  "body": "Some of the example code requests contain IDs of objects. To run these examples in your own sandbox, you must replace these IDs with IDs of objects you have already created in it."
}
[/block]

[block:api-header]
{
  "title": "Notes"
}
[/block]
* The utility files require your access key and secret key. You can get these values from the Client Portal. See [Managing My Account](doc:managing-my-account).
* For API methods that have more than one request example, the code samples cover only the first request example provided. You can duplicate and modify these files according to your own requirements.
* The `idempotency` header is relevant for [Create Payment](ref:create-payment). It is ignored in all other requests.
[block:api-header]
{
  "title": "Utilities"
}
[/block]

The following utilities represent the core code that must be included to make the code samples run.
[block:code]
{
  "codes": [
    {
      "code": "using System;\nusing System.IO;\nusing System.Net;\nusing System.Security.Cryptography;\nusing System.Text;\n\nnamespace RapydApiRequestSample\n{\n    public static class Utilities\n    {\n        private const string accessKey = \"<your-access-key>\";\n        private const string secretKey = \"<your-secret-key>\";\n        private const bool log = false;\n\n        public static string MakeRequest(string method, string urlPath, string body = null)\n        {\n            try\n            {\n                string httpMethod = method;\n                Uri httpBaseURL = new Uri(\"https://sandboxapi.rapyd.net\");\n                string httpURLPath = urlPath;\n                string httpBody = body;\n                string salt = GenerateRandomString(8);\n                long timestamp = DateTimeOffset.Now.ToUnixTimeSeconds();\n                string signature = Sign(httpMethod, httpURLPath, salt, timestamp, httpBody);\n\n                Uri httpRequestURL = new Uri(httpBaseURL, urlPath);\n                WebRequest request = HttpWebRequest.Create(httpRequestURL);\n                request.Method = httpMethod;\n                request.ContentType = \"application/json\";\n                request.Headers.Add(\"salt\", salt);\n                request.Headers.Add(\"timestamp\", timestamp.ToString());\n                request.Headers.Add(\"signature\", signature);\n                request.Headers.Add(\"access_key\", accessKey);\n\n                if (log)\n                {\n                    Console.WriteLine(\"web request method: \" + httpMethod);\n                    Console.WriteLine(\"web request url: \" + httpRequestURL);\n                    Console.WriteLine(\"web request body: \" + httpBody);\n                    Console.WriteLine(\"web request contentType: \" + request.ContentType);\n                    Console.WriteLine(\"web request salt: \" + salt);\n                    Console.WriteLine(\"web request timestamp: \" + timestamp);\n                    Console.WriteLine(\"web request signature: \" + signature);\n                    Console.WriteLine(\"web request access_key: \" + accessKey);\n                }\n\n                return HttpRequest(request, body);\n            }\n            catch (Exception ex)\n            {\n                Console.WriteLine(\"Error generating request options: \", ex);\n                throw;\n            }\n        }\n\n\n        private static string Sign(string method, string urlPath, string salt, long timestamp, string body)\n        {\n\n            try\n            {\n                string bodyString = String.Empty;\n                if (!String.IsNullOrWhiteSpace(body))\n                {\n                    bodyString = body == \"{}\" ? \"\" : body;\n                }\n\n                string toSign = method.ToLower() + urlPath + salt + timestamp + accessKey + secretKey + bodyString;\n                if (log)\n                {\n                    Console.WriteLine(\"\\ntoSign: \" + toSign);\n                }\n\n                UTF8Encoding encoding = new UTF8Encoding();\n                byte[] secretKeyBytes = encoding.GetBytes(secretKey);\n                byte[] signatureBytes = encoding.GetBytes(toSign);\n                string signature = String.Empty;\n                using (HMACSHA256 hmac = new HMACSHA256(secretKeyBytes))\n                {\n                    byte[] signatureHash = hmac.ComputeHash(signatureBytes);\n                    string signatureHex = String.Concat(Array.ConvertAll(signatureHash, x => x.ToString(\"x2\")));\n                    signature = Convert.ToBase64String(encoding.GetBytes(signatureHex));\n                }\n\n                if (log)\n                {\n                    Console.WriteLine(\"signature: \" + signature);\n                }\n\n                return signature;\n            }\n            catch (Exception)\n            {\n                Console.WriteLine(\"Error generating signature\");\n                throw;\n            }\n\n        }\n        private static string GenerateRandomString(int size)\n        {\n            try\n            {\n                using (RandomNumberGenerator rng = new RNGCryptoServiceProvider())\n                {\n                    byte[] randomBytes = new byte[size];\n                    rng.GetBytes(randomBytes);\n                    return String.Concat(Array.ConvertAll(randomBytes, x => x.ToString(\"x2\")));\n                }\n            }\n            catch (Exception)\n            {\n                Console.WriteLine(\"Error generating salt\");\n                throw;\n            }\n        }\n\n        private static string HttpRequest(WebRequest request, string body)\n        {\n            string response = String.Empty;\n\n            try\n            {\n                if (!String.IsNullOrWhiteSpace(body))\n                {\n                    using (Stream requestStream = request.GetRequestStream())\n                    {\n                        UTF8Encoding encoding = new UTF8Encoding();\n                        byte[] bodyBytes = encoding.GetBytes(body);\n                        requestStream.Write(bodyBytes, 0, bodyBytes.Length);\n                        requestStream.Close();\n                    }\n                }\n\n                using (WebResponse webResponse = request.GetResponse())\n                {\n                    using (Stream responseStream = webResponse.GetResponseStream())\n                    {\n                        using (StreamReader streamReader = new StreamReader(responseStream))\n                        {\n                            response = streamReader.ReadToEnd();\n                            if (log)\n                            {\n                                Console.Write(\"web response:\" + response);\n                            }\n                        }\n                    }\n                }\n            }\n            catch (WebException e)\n            {\n                using (StreamReader streamReader = new StreamReader(e.Response.GetResponseStream()))\n                {\n                    response = streamReader.ReadToEnd();\n                    if (log)\n                    {\n                        Console.Write(\"web response:\" + response);\n                    }\n                }\n            }\n            catch (Exception e)\n            {\n                Console.WriteLine(\"Error occurred: \" + e.Message);\n            }\n\n            return response;\n        }\n    }\n}",
      "language": "text",
      "name": ".NET Core"
    },
    {
      "code": "const https = require('https');\nconst crypto = require('crypto');\nconst accessKey = \"<your-access-key>\";\nconst secretKey = \"<your-secret-key>\";\nconst log = false;\n\nasync function makeRequest(method, urlPath, body = null) {\n\n    try {\n        httpMethod = method;\n        httpBaseURL = \"sandboxapi.rapyd.net\";\n        httpURLPath = urlPath;\n        salt = generateRandomString(8);\n        idempotency = new Date().getTime().toString();\n        timestamp = Math.round(new Date().getTime() / 1000);\n        signature = sign(httpMethod, httpURLPath, salt, timestamp, body)\n\n        const options = {\n            hostname: httpBaseURL,\n            port: 443,\n            path: httpURLPath,\n            method: httpMethod,\n            headers: {\n                'Content-Type': 'application/json',\n                salt: salt,\n                timestamp: timestamp,\n                signature: signature,\n                access_key: accessKey,\n                idempotency: idempotency\n            }\n        }\n\n        return await httpRequest(options, body, log);\n    }\n    catch (error) {\n        console.error(\"Error generating request options\");\n        throw error;\n    }\n}\n\nfunction sign(method, urlPath, salt, timestamp, body) {\n\n    try {\n        let bodyString = \"\";\n        if (body) {\n            bodyString = JSON.stringify(body);\n            bodyString = bodyString == \"{}\" ? \"\" : bodyString;\n        }\n\n        let toSign = method.toLowerCase() + urlPath + salt + timestamp + accessKey + secretKey + bodyString;\n        log && console.log(`toSign: ${toSign}`);\n\n        let hash = crypto.createHmac('sha256', secretKey);\n        hash.update(toSign);\n        const signature = Buffer.from(hash.digest(\"hex\")).toString(\"base64\")\n        log && console.log(`signature: ${signature}`);\n\n        return signature;\n    }\n    catch (error) {\n        console.error(\"Error generating signature\");\n        throw error;\n    }\n}\n\nfunction generateRandomString(size) {\n    try {\n        return crypto.randomBytes(size).toString('hex');\n    }\n    catch (error) {\n        console.error(\"Error generating salt\");\n        throw error;\n    }\n}\n\nasync function httpRequest(options, body) {\n\n    return new Promise((resolve, reject) => {\n\n        try {\n            \n            let bodyString = \"\";\n            if (body) {\n                bodyString = JSON.stringify(body);\n                bodyString = bodyString == \"{}\" ? \"\" : bodyString;\n            }\n\n            log && console.log(`httpRequest options: ${JSON.stringify(options)}`);\n            const req = https.request(options, (res) => {\n                let response = {\n                    statusCode: res.statusCode,\n                    headers: res.headers,\n                    body: ''\n                };\n\n                res.on('data', (data) => {\n                    response.body += data;\n                });\n\n                res.on('end', () => {\n\n                    response.body = response.body ? JSON.parse(response.body) : {}\n                    log && console.log(`httpRequest response: ${JSON.stringify(response)}`);\n\n                    if (response.statusCode !== 200) {\n                        return reject(response);\n                    }\n\n                    return resolve(response);\n                });\n            })\n            \n            req.on('error', (error) => {\n                return reject(error);\n            })\n            \n            req.write(bodyString)\n            req.end();\n        }\n        catch(err) {\n            return reject(err);\n        }\n    })\n\n}\n\nexports.makeRequest = makeRequest;\n",
      "language": "javascript"
    },
    {
      "code": "<?php\nfunction generate_string($length=12) {\n    $permitted_chars = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\n    return substr(str_shuffle($permitted_chars), 0, $length);\n}\n\n\n// make_request method - Includes the logic to communicate with the Rapyd sandbox server.\nfunction make_request($method, $path, $body = null) {\n    $base_url = 'https://sandboxapi.rapyd.net';\n    $access_key = '<your-access-key>';     // The access key received from Rapyd.\n    $secret_key = '<your-secret-key>';     // Never transmit the secret key by itself.\n\n    $idempotency = generate_string();      // Unique for each request.\n    $http_method = $method;                // Lower case.\n    $salt = generate_string();             // Randomly generated for each request.\n    $date = new DateTime();\n    $timestamp = $date->getTimestamp();    // Current Unix time.\n\n    $body_string = !is_null($body) ? json_encode($body,JSON_UNESCAPED_SLASHES) : '';\n    $sig_string = \"$http_method$path$salt$timestamp$access_key$secret_key$body_string\";\n\n    $hash_sig_string = hash_hmac(\"sha256\", $sig_string, $secret_key);\n    $signature = base64_encode($hash_sig_string);\n\n    $request_data = NULL;\n\n    if ($method === 'post') {\n        $request_data = array(\n            CURLOPT_URL => \"$base_url$path\",\n            CURLOPT_RETURNTRANSFER => true,\n            CURLOPT_POST => true,\n            CURLOPT_POSTFIELDS => $body_string\n            \n        );\n    } else {\n        $request_data = array(\n            CURLOPT_URL => \"$base_url$path\",\n            CURLOPT_RETURNTRANSFER => true,\n        );\n    }\n\n    $curl = curl_init();\n    curl_setopt_array($curl, $request_data);\n\n    curl_setopt($curl, CURLOPT_HTTPHEADER, array(\n        \"Content-Type: application/json\",\n        \"access_key: $access_key\",\n        \"salt: $salt\",\n        \"timestamp: $timestamp\",\n        \"signature: $signature\",\n        \"idempotency: $idempotency\"\n    ));\n\n    $response = curl_exec($curl);\n    $err = curl_error($curl);\n    curl_close($curl);\n\n    if ($err) {\n        throw new Exception(\"cURL Error #:\".$err);\n    } else {\n        return json_decode($response, true); \n    }\n}\n?>",
      "language": "php"
    },
    {
      "code": "import json\nimport random\nimport string\nimport hmac\nimport base64\nimport hashlib\nimport time\nimport requests\n\nbase_url = 'https://sandboxapi.rapyd.net'\naccess_key = '<your-access-key>'\nsecret_key = '<your-secret-key>'\n\ndef generate_salt(length=12):\n    return ''.join(random.sample(string.ascii_letters + string.digits, length))\n\ndef get_unix_time(days=0, hours=0, minutes=0, seconds=0):\n    return int(time.time())\n\ndef update_timestamp_salt_sig(http_method, path, body):\n    if path.startswith('http'):\n        path = path[path.find(f'/v1'):]\n    salt = generate_salt()\n    timestamp = get_unix_time()\n    to_sign = (http_method, path, salt, str(timestamp), access_key, secret_key, body)\n    \n    h = hmac.new(secret_key.encode('utf-8'), ''.join(to_sign).encode('utf-8'), hashlib.sha256)\n    signature = base64.urlsafe_b64encode(str.encode(h.hexdigest()))\n    return salt, timestamp, signature\n\ndef current_sig_headers(salt, timestamp, signature):\n    sig_headers = {'access_key': access_key,\n                   'salt': salt,\n                   'timestamp': str(timestamp),\n                   'signature': signature,\n                   'idempotency': str(get_unix_time()) + salt}\n    return sig_headers\n\ndef pre_call(http_method, path, body=None):\n    str_body = json.dumps(body, separators=(',', ':'), ensure_ascii=False) if body else ''\n    salt, timestamp, signature = update_timestamp_salt_sig(http_method=http_method, path=path, body=str_body)\n    return str_body.encode('utf-8'), salt, timestamp, signature\n\ndef create_headers(http_method, url,  body=None):\n    body, salt, timestamp, signature = pre_call(http_method=http_method, path=url, body=body)\n    return body, current_sig_headers(salt, timestamp, signature)\n\ndef make_request(method,path,body=''):\n    body, headers = create_headers(method, base_url + path, body)\n\n    if method == 'get':\n        response = requests.get(base_url + path,headers=headers)\n    elif method == 'put':\n        response = requests.put(base_url + path, data=body, headers=headers)\n    elif method == 'delete':\n        response = requests.delete(base_url + path, data=body, headers=headers)\n    else:\n        response = requests.post(base_url + path, data=body, headers=headers)\n\n    if response.status_code != 200:\n        raise TypeError(response, method,base_url + path)\n    return json.loads(response.content)\n",
      "language": "python"
    }
  ]
}
[/block]